server {
  # 監聽 80 port
  listen 80;

  # 新增區塊：處理所有 API 請求
  # 這個 location 區塊會攔截所有對 /api/... 的請求
  # 並將它們反向代理到後端服務
  location /api/ {
    # 'backend' 是我們在 docker-compose.yml 中定義的後端服務名稱。
    # Docker 的內部 DNS 會將它解析到後端容器的內部 IP。
    # 後端服務監聽 5001 port。
    proxy_pass http://backend:5000;

    # 這些是設定反向代理時建議加入的標頭，
    # 以確保後端服務能正確獲取原始請求的資訊。
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # 原有的區塊：處理所有非 API 的請求 (也就是前端應用本身)
  location / {
    # 設定根目錄為 Nginx 映像檔的預設網站目錄
    root /usr/share/nginx/html;
    # 設定預設的索引文件
    index index.html index.htm;
    # 關鍵設定：讓 React Router 接手處理所有前端路由
    try_files $uri $uri/ /index.html;
  }
} 