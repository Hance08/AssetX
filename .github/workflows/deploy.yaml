name: Deploy to VM

on:
  push:
    branches:
      - main # 當推送到 main 分支時觸發

jobs:
  build-and-deploy:
    # 這是關鍵：指定此任務要在自託管的執行器上執行
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Skaffold
        # 這是正確的做法：透過環境變數來設定倉庫
        env:
          SKAFFOLD_DEFAULT_REPO: localhost:5000
        # Skaffold 會使用上面的環境變數作為預設倉庫
        run: skaffold run --filename skaffold.yaml 